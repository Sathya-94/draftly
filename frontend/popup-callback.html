<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>OAuth Callback</title>
  </head>
  <body>
    <script>
      // Parse tokens from query string
      const params = new URLSearchParams(window.location.search);
      const accessToken = params.get("accessToken");
      const refreshToken = params.get("refreshToken");

      if (accessToken && refreshToken) {
        // BroadcastChannel (primary)
        try {
          const channel = new BroadcastChannel("draftly-auth");
          channel.postMessage({ accessToken, refreshToken });
          channel.close();
        } catch (err) {
          console.error("BroadcastChannel unavailable", err);
        }

        // postMessage fallback to opener (same-origin)
        try {
          if (window.opener && window.opener.location?.origin === window.location.origin) {
            window.opener.postMessage({ accessToken, refreshToken }, window.location.origin);
          }
        } catch (err) {
          console.error("postMessage to opener failed", err);
        }
      }

      // Close popup
      window.close();
    </script>
  </body>
</html>
